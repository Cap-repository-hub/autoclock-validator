- name: Check that the agave-validator exists
  stat:
    path: "{{ path_to_project }}/{{ repo_version }}/bin/agave-validator"
  register: agave_result


- name: build solana
  become: true
  become_user: solana
  shell: ". \"$HOME/.cargo/env\" && CI_COMMIT=$(git rev-parse HEAD) scripts/cargo-install-all.sh {{ path_to_project }}/{{ repo_version }} &>>{{ path_to_project }}/logs/build.log"
  args:
    chdir: "{{ path_to_project }}/{{ repo_dir }}"
    executable: /bin/bash
    when: not agave_result.stat.exists
